---
title: "Initial data exploration"
date: "Oct 12, 2019"
author: "Margaret Reed, Daniel Hwang, Yi Chen"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r import-libraries}
library(tidyverse)
library(broom)
library(dplyr)
library(lubridate)
library(stringr)
library(tidytext)
library(textdata)
library(SnowballC)


data(stop_words)
afinn <- get_sentiments("afinn")
bing <- get_sentiments("bing")
nrc <- get_sentiments("nrc")
```

```{r import-data}
data <- read_csv("data.csv") %>%
  tidy()
```


```{r lubridate}
data <- data %>%
  mutate(dateTime = ymd_hms(CreatedDate),
         Year = year(dateTime),
         Month = month(dateTime),
         Day = day(dateTime),
         Date = paste(Year, Month, Day, sep = "-") %>% ymd() %>% as.Date()) %>%
  select(-dateTime, -Day, -Month, -Year) %>%
  select(Date, everything())
```


```{r date-viz}
data %>%
  ggplot(aes(x = Date)) +
  geom_histogram(bins = 100)
```

```{r small-data}
smallData <- data %>%
  slice(1:20)
```


```{r small-data-test}
textSmallData <- smallData %>%
  select(Date, Title, StoryID) %>%
  unnest_tokens(word, Title)

textFreq <- data %>%
  select(Date, Title, StoryID) %>%
  unnest_tokens(word, Title) %>%
  anti_join(stop_words) %>%
  count(word, sort = TRUE)

textFreq %>%
  filter(n>= 100) %>%
  ggplot(aes(x = word, y = n)) +
    geom_col()
```


```{r bing-edit}
bing <- bing %>%
  mutate(sentValue = case_when(
    sentiment == "negative" ~ -1,
    sentiment == "positive" ~ 1
  ))
```



```{r sentiment-begin}
textData <- data %>%
  select(Date, Title, StoryID) %>%
  unnest_tokens(word, Title) %>%
  inner_join(afinn) %>%
  group_by(StoryID) %>%
  summarize(meanSent = mean(value),
            tot_words = n())
```


```{r hits}
hitsSentData <- full_join(data, textData) %>%
  select(StoryID, Hits, meanSent) %>%
  drop_na()

hitsSentData %>%
  ggplot(aes(x = meanSent, y = Hits)) +
  geom_point()
```



```{r countrySplit}
dataUSA <- subset(data, Country_USA == 1)
dataGBR <- subset(data, Country_GBR == 1)
dataCAN <- subset(data, Country_CAN == 1)

dataUSA %>%
  select(Title, Hits)

```



```{r tags}
# condenses tags into one tags column and their boolean into hasTag
allTags <- gather(data, "tags", "hasTag", 13:35) 
allTags <- allTags[order(allTags$StoryID),]

# to find all tags associated with an article, filter for hasTag is true
allTags %>%
  filter(StoryID == 184098 & hasTag == 1) %>%
  select(Title, tags)

# creates a dataframe with story titles and their tag counts
tagCounts <- allTags %>%
  group_by(StoryID) %>%
  count(hasTag == 1) %>%
  select(StoryID, n) %>%
  rename(numTags = n)

toDelete <- seq(1, nrow(tagCounts), 2)

toDelete

tagCounts <- tagCounts[-toDelete, ]

data <- data %>%
  full_join(tagCounts)

```
