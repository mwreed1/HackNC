---
title: "data dashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    social: menu
runtime: shiny
---

```{r load-packages, include=FALSE}
library(flexdashboard)
library(shiny)
library(tidyverse)
library(broom)
library(dplyr)
library(lubridate)
library(stringr)
library(tidytext)
library(textdata)
library(SnowballC)
library(DT)
```

```{r load-data, include = FALSE}
data <- read_csv("data.csv") %>%
  as.tibble()

data <- data %>%
  mutate(dateTime = ymd_hms(CreatedDate),
         Year = year(dateTime),
         Month = month(dateTime),
         Day = day(dateTime),
         Date = paste(Year, Month, Day, sep = "-") %>% ymd() %>% as.Date()) %>%
  select(-dateTime, -Day, -Month, -Year) %>%
  select(Date, everything()) %>%
  mutate(Title = as.character(Title), 
         Summary = as.character(Summary),
         Body = as.character(Body))
```


Sidebar {.sidebar}
=======================================================================

### NFL Draft Statistics

```{r-filter-data}
hr()
selectInput("tag", "Choose desired tags:",
                  list(`RealEstate` = list("Development", "Land", "Lease", "MixedUse", "Retail", "Sale", "SpecialPurpose"),
                       `Workforce` = list("Company", "CompaniesPeople", "Office"),
                       `Business` = list("Analytics", "Finance", "Investment"),
                       `PublicServices` = list("Healthcare", "Hospitality", "Multifamily", "People", "PublicSector"),
                       `Sectors/Misc` = list("Events", "Industrial", "Legal", "National")
                  ),
                  selected = list("Development", "Company", "Analytics", "Healthcare"),
                  multiple = TRUE)
hr()

checkboxGroupInput(inputId = "country",
                         label = "Select countries:",
                         choices = c("Canada", "US", "GB") ,
                         selected = "US")
hr()

sel_data <- reactive({
data %>%
    dplyr::filter(
      between(year, input$year[1], input$year[2])
      ) %>%
})
```


Dashboard
=======================================================================

Row
-----------------------------------------------------------------------

### Average career approximate value {.value-box}

```{r-avg-carAV}
renderValueBox({
  valueBox(value = round(mean(sel_data()$Hits, na.rm = TRUE), 2), 
           icon = "glyphicon-hand-up")
})
```

### Average age of players {.value-box}

```{r}
renderValueBox({
  valueBox(value = round(mean(sel_data()$numtags, na.rm = TRUE), 2), 
           icon = "glyphicon-hourglass")
})
```

Row
-----------------------------------------------------------------------

### Visualization {data-width=700}

```{r word-freq-viz}
textFreq <- data %>%
  select(Date, Title, StoryID) %>%
  unnest_tokens(word, Title) %>%
  anti_join(stop_words) %>%
  count(word, sort = TRUE)

textFreq$word <- factor(textFreq$word, levels = textFreq$word[order(desc((textFreq$n)))])
```

```{r}
renderPlot({
  textFreq %>%
    filter(n>= 75) %>%
  ggplot(aes(x = word, y = n)) +
    geom_col() +
  labs(x = "Words", y = "Frequency", title = "Most frequent words in Titles")
  })
```

Data
=======================================================================

### About the data

This [flexdashboard](https://rmarkdown.rstudio.com/flexdashboard/) uses data 
from [Pro Football Reference](http://www.pro-football-reference.com/).

The data used in the analysis is shown below.

```{r-data-table}
DT::renderDataTable({
  datatable( sel_data() )
})
```